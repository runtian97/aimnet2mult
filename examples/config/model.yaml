# Model Configuration
# AIMNet2 model with NSE (Net Spin Excess) for open-shell systems
#
# Note: charges and spin_charges are predicted by the main model via
# message passing + NSE constraint, NOT as separate output heads.
# - charges: predicted iteratively, constrained to sum to molecular charge
# - spin_charges: computed as (alpha - beta) in postprocessing

class: aimnet2mult.models.aimnet2.AIMNet2

kwargs:
  # Feature dimensions
  nfeature: 16
  d2features: true
  ncomb_v: 12
  hidden:
    - [ 512, 380 ]
    - [ 512, 380 ]
    - [ 512, 380, 380 ]

  # AIM representation size
  aim_size: 256

  # Number of charge channels: 2 for open-shell (NSE mode)
  num_charge_channels: 2

  # Atomic Environment Vector (AEV) settings
  aev:
    rc_s: 5.0
    nshifts_s: 16

  # Output heads
  outputs:
    energy_mlp:
      class: aimnet2mult.modules.Output
      kwargs:
        n_in: 256
        n_out: 1
        key_in: 'aim'
        key_out: 'energy'
        mlp:
          activation_fn: torch.nn.GELU
          hidden: [128, 128]
          last_linear: true

    atomic_shift:
      class: aimnet2mult.modules.AtomicShift
      kwargs:
        key_in: 'energy'
        key_out: 'energy'

    atomic_sum:
      class: aimnet2mult.modules.AtomicSum
      kwargs:
        key_in: 'energy'
        key_out: 'energy'

    lrcoulomb:
      class: aimnet2mult.modules.LRCoulomb
      kwargs:
        key_in: 'charges'
        key_out: 'energy'
        method: 'simple'
        rc: 4.6
